#include "TouchCalibration.h"                                                    // Заголовок с объявлениями переменных и функций калибровки тача
//
#include <algorithm>                                                              // Для std::min/std::max (на случай использования в заголовке)
//
bool g_touch_calibrated = false;                                                  // Флаг: прошла ли калибровка тачскрина
bool g_touch_swap_axes  = false;                                                  // Флаг перестановки осей X/Y
uint16_t g_tx_min = 300;                                                          // Минимальное калибровочное значение по X
uint16_t g_tx_max = 3900;                                                         // Максимальное значение по X
uint16_t g_ty_min = 200;                                                          // Минимальное значение по Y
uint16_t g_ty_max = 3900;                                                         // Максимальное значение по Y
//
int16_t map_clamped(int32_t v, int32_t in_min, int32_t in_max,                    // Функция линейного преобразования с ограничением диапазона
                    int32_t out_min, int32_t out_max) {                           // Преобразует значение из входного диапазона в выходной
  if (in_min == in_max) {                                                         // Если входной диапазон вырожден
    return static_cast<int16_t>(out_min);                                         // Возвращаем минимальное выходное значение, чтобы избежать деления на ноль
  }                                                                               // Завершение проверки вырожденного диапазона
  if (in_min < in_max) {                                                          // Если диапазон растёт по мере увеличения индекса
    if (v < in_min) v = in_min;                                                   // Ограничиваем значение снизу
    if (v > in_max) v = in_max;                                                   // Ограничиваем значение сверху
  } else {                                                                        // Иначе диапазон задан в обратном порядке
    if (v > in_min) v = in_min;                                                   // Корректируем верхнее ограничение
    if (v < in_max) v = in_max;                                                   // Корректируем нижнее ограничение
  }                                                                               // Завершение ветки ограничения
  return static_cast<int16_t>(out_min +                                           // Выполняем линейное преобразование с использованием 64-битного промежуточного результата
                              (int64_t)(v - in_min) * (out_max - out_min) /
                                  (in_max - in_min));
}                                                                                 // Завершение функции map_clamped
//
void resetTouchCalibrationToDefaults() {                                          // Сбрасываем значения калибровки тача к заводским
  g_touch_calibrated = false;                                                     // Отмечаем, что калибровка не проведена
  g_touch_swap_axes  = false;                                                     // Сбрасываем перестановку осей
  g_tx_min = 300;                                                                 // Восстанавливаем минимальное значение X
  g_tx_max = 3900;                                                                // Восстанавливаем максимальное значение X
  g_ty_min = 200;                                                                 // Восстанавливаем минимальное значение Y
  g_ty_max = 3900;                                                                // Восстанавливаем максимальное значение Y
}                                                                                 // Завершение функции сброса

